FROM dqneo/perl:5.20.1
MAINTAINER DQNEO

RUN yum -y install libjpeg-turbo libjpeg-turbo-devel libpng-devel; yum clean all

RUN mkdir -p /opt/ImageMagick/src
WORKDIR /opt/ImageMagick/src/

RUN curl https://raw.githubusercontent.com/DQNEO/cookbook-imagemagick/master/files/default/ImageMagick-6.8.6-10.tar.gz -o ImageMagick-6.8.6-10.tar.gz \
  && tar xf ImageMagick-6.8.6-10.tar.gz \
  && rm ImageMagick-6.8.6-10.tar.gz \
  && cd ImageMagick-6.8.6-10 \
  && ./configure --prefix=/opt/ImageMagick --enable-shared --disable-openmp --disable-opencl --without-x --with-perl=/opt/perl/bin/perl \
  && make \
  && make install \
  && make clean \
  && rm -rf /opt/ImageMagick/share \
  && rm -rf /opt/ImageMagick/src

# add library path
RUN echo '/opt/ImageMagick/lib/' > /etc/ld.so.conf.d/imagemagick.conf \
    && ldconfig

CMD /opt/perl/bin/perl -MImage::Magick -E 'say $Image::Magick::Q16::VERSION'
